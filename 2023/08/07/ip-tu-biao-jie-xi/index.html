<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="计算机系列-IP图表分析, 豪哥博客">
    <meta name="description" content="豪哥个人博客">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>计算机系列-IP图表分析 | 豪哥博客</title>
    <link rel="icon" type="image/png" href="/favicon.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">

    <script src="/libs/jquery/jquery.min.js"></script>

<meta name="generator" content="Hexo 6.3.0"></head>




<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">豪哥博客</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/contact" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>留言板</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>友情链接</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">豪哥博客</div>
        <div class="logo-desc">
            
            豪哥个人博客
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			留言板
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			友情链接
		</a>
          
        </li>
        
        
    </ul>
</div>


        </div>

        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/0.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">计算机系列-IP图表分析</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        width: 345px;
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        padding: 35px 0 15px 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        padding-bottom: 30px;
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;

        position: absolute;
        right: 23.5vw;
        display: block;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/">
                                <span class="chip bg-color">网络协议</span>
                            </a>
                        
                            <a href="/tags/IP/">
                                <span class="chip bg-color">IP</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA/" class="post-category">
                                计算机
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2023-08-07
                </div>
                

                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-check fa-fw"></i>更新日期:&nbsp;&nbsp;
                    2023-08-05
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp;
                    7.4k
                </div>
                

                

                
            </div>
        </div>
        <hr class="clearfix">

        
        <!-- 是否加载使用自带的 prismjs. -->
        <link rel="stylesheet" href="/libs/prism/prism.css">
        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <h1 id="IP基本认识"><a href="#IP基本认识" class="headerlink" title="IP基本认识"></a>IP基本认识</h1><h2 id="IP作用"><a href="#IP作用" class="headerlink" title="IP作用"></a>IP作用</h2><p><font color='orange'>IP 在 TCP&#x2F;IP 参考模型中处于第三层，即⽹络层。</font></p>
<p>⽹络层主要作⽤：实现主机之间的通信，也叫点对点（end to end）通信。</p>
<p><img src="https://raw.githubusercontent.com/lucky2shh/blog-haogeblogs-image/master/2023/08/05/image-20210415201526742.png?token=AIGEF3IBSDVTZBJISBUOCC3EZZQHC" alt="image-20210415201526742"></p>
<h2 id="IP与MAC关系"><a href="#IP与MAC关系" class="headerlink" title="IP与MAC关系"></a>IP与MAC关系</h2><p><font color='orange'>MAC可以实现两个直连设备间的通信；IP可以实现两个无直连⽹络间的通信。</font></p>
<p>举个⽣活的栗⼦，⼩林要去⼀个很远的地⽅旅⾏，制定了⼀个⾏程表，其间需先后乘坐⻜机、地铁、公 交⻋才能抵达⽬的地，为此⼩林需要买⻜机票，地铁票等。⻜机票和地铁票都是去往特定的地点的，每张票只能够在某⼀限定区间内移动。</p>
<p><img src="https://raw.githubusercontent.com/lucky2shh/blog-haogeblogs-image/master/2023/08/05/image-20210415202504342.png?token=AIGEF3IBSRHYSGRCHUUDKGTEZZQIU" alt="image-20210415202504342"></p>
<p>同时要注意，如果⼩林只有⾏程表⽽没有⻋票，就⽆法搭乘交通⼯具到达⽬的地。相反，如果除了⻋票⽽没有⾏程表，恐怕也很难到达⽬的地。因为⼩林不知道该坐什么⻋，也不知道该在哪⾥换乘。</p>
<p>针对以上描述，可总结如下：</p>
<ul>
<li>此处的「区间内移动」就如同数据链路层。</li>
<li>区间内的出发点好⽐源 MAC 地址，⽬标地点好⽐⽬的 MAC 地址。</li>
<li>整个旅游⾏程表就相当于⽹络层。</li>
<li>⾏程的开始好⽐源 IP，⾏程的终点好⽐⽬的 IP 地址。</li>
<li>计算机⽹络中同时需要「数据链路层」和「⽹络层」两个分层才能实现与最终⽬标地址的通信。</li>
<li>在⽹络数据包传输中，源IP地址和⽬标IP地址不会变化，只有源 MAC 地址和⽬标 MAC ⼀直在变化。</li>
</ul>
<h1 id="IP地址基础知识"><a href="#IP地址基础知识" class="headerlink" title="IP地址基础知识"></a>IP地址基础知识</h1><h2 id="IP地址定义"><a href="#IP地址定义" class="headerlink" title="IP地址定义"></a>IP地址定义</h2><p>TCP&#x2F;IP ⽹络通信时，为了保证正常通信，每个设备都需要配置正确的 IP 地址，否则⽆法实现正常通信。</p>
<p> <font color='orange'>IP 地址（IPv4 地址）由 32 位正整数表示，IP 在计算机中是以⼆进制⽅式处理。 ⽽⼈类为了⽅便记忆采⽤了点分⼗进制的标记⽅式，也就是将 32 位 IP 地址以每 8 位为1组，共分为 4 组，每组以「 . 」隔开，再将每组转换成⼗进制。</font></p>
<p><img src="https://raw.githubusercontent.com/lucky2shh/blog-haogeblogs-image/master/2023/08/05/image-20210415203544505.png?token=AIGEF3NLJYYBD5VDNBBQTHTEZZQKW" alt="image-20210415203544505"></p>
<p>那么， <font color='orange'>IP 地址最⼤值就是：<code>2^32 = 4294967296</code>，也就是说最大允许43亿台计算机连接到网络。</font></p>
<p>实际上， <font color='orange'>IP 地址并非根据主机台数来配置，⽽是根据⽹卡来配置。</font> <font color='orange'>IP 地址是由「⽹络标识」和「主机标识」两个部分组成，能够连接到⽹络的计算机个数很少。</font></p>
<blockquote>
<p>电脑配了 IP， ⼿机、IPad 等电⼦设备都配了 IP， 照理来说肯定会超过 43 亿啦，那是怎么能够⽀持这么多 IP 的呢？因为会根据⼀种可以更换 IP 地址的技术 NAT ，使得可连接计算机数超过 43 亿台。 </p>
</blockquote>
<h2 id="IP地址分类"><a href="#IP地址分类" class="headerlink" title="IP地址分类"></a>IP地址分类</h2><h3 id="IP地址类型"><a href="#IP地址类型" class="headerlink" title="IP地址类型"></a>IP地址类型</h3><p>互联⽹诞⽣之初，IP 地址显得很充裕，于是计算机科学家们设计了分类地址。 </p>
<p> <font color='orange'>IP 地址分类成了 5 种类型：A 类、B 类、C 类、D 类、E 类。</font></p>
<p><img src="https://raw.githubusercontent.com/lucky2shh/blog-haogeblogs-image/master/2023/08/05/image-20210415204302389.png?token=AIGEF3MRG4SAOL4EIUZ7TALEZZQMK" alt="image-20210415204302389"></p>
<p>上图中⻩⾊部分为分类号，⽤以区分 IP 地址类别。</p>
<h3 id="A、B、C类型地址"><a href="#A、B、C类型地址" class="headerlink" title="A、B、C类型地址"></a>A、B、C类型地址</h3><p> <font color='orange'>A、B、C 类IP地址主要分为两个部分，分别是⽹络号和主机号。</font></p>
<p>A、B、C 分类对应的地址范围、最⼤主机个数如下：</p>
<p><img src="https://raw.githubusercontent.com/lucky2shh/blog-haogeblogs-image/master/2023/08/05/image-20210415204603352.png?token=AIGEF3LROQ3FWAKUIANXEN3EZZQN2" alt="image-20210415204603352"></p>
<p> <font color='orange'>最⼤主机数，就是看主机号的位数</font>，如 C 类地址的主机号占 8 位，那么 C 类地址的最⼤主机个数：</p>
<pre class="line-numbers language-none"><code class="language-none">2^8 - 2 &#x3D; 254<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>为什么要减 2 呢？ 因为在 IP 地址中，有两个 IP 是特殊的，分别是主机号全为 1 和 全为 0 地址。</p>
<ul>
<li><font color='orange'>主机号全为 1 指的是 某个⽹络下的所有主机，⽤于⼴播。</font></li>
<li><font color='orange'>主机号全为 0 指的是 某个⽹络。</font></li>
</ul>
<h3 id="D、E类型地址"><a href="#D、E类型地址" class="headerlink" title="D、E类型地址"></a>D、E类型地址</h3><p> <font color='orange'>D 类和 E 类地址没有主机号，所以不可⽤于主机 IP，D 类常被⽤于多播，E 类是预留分类， 暂未使⽤。</font></p>
<p><img src="https://raw.githubusercontent.com/lucky2shh/blog-haogeblogs-image/master/2023/08/05/image-20210415205817207.png?token=AIGEF3KWRVXXTJFBF2M32T3EZZQPC" alt="image-20210415205817207"></p>
<p> <font color='orange'>多播地址作用：多播⽤于将包发送给特定组内的所有主机。</font></p>
<p>多播使⽤ D 类地址，其前四位是 1110 的就表示是多播地址，⽽剩下的 28 位是多播的组编号。 </p>
<p>从 224.0.0.0 ~ 239.255.255.255 都是多播的可⽤范围，其划分为以下三类：</p>
<ul>
<li>224.0.0.0 ~ 224.0.0.255 为预留的组播地址，只能在局域⽹中，路由器是不会进⾏转发的。</li>
<li>224.0.1.0 ~ 238.255.255.255 为⽤户可⽤的组播地址，可以⽤于 Internet 上。</li>
<li>239.0.0.0 ~ 239.255.255.255 为本地管理组播地址，可供内部⽹内部使⽤，仅在特定的本地范围有效。</li>
</ul>
<h3 id="广播地址"><a href="#广播地址" class="headerlink" title="广播地址"></a>广播地址</h3><p> <font color='orange'>⼴播地址⽤于在同⼀个链路中相互连接的主机之间发送数据包。</font></p>
<p>当主机号全为 1 时，就表示该⽹络的⼴播地址。</p>
<p>⼴播地址可以分为本地⼴播和直接⼴播两种：</p>
<ul>
<li><font color='orange'>本⽹络内进行⼴播 称为 本地⼴播</font></li>
</ul>
<p>  例如⽹络地址为 192.168.0.0&#x2F;24 的情况下，⼴播地址是 192.168.0.255 。因为这个⼴播地址的 IP 包会被路由器屏蔽，所以不会到达 192.168.0.0&#x2F;24 以外的 其他链路上。</p>
<ul>
<li><font color='orange'>不同⽹络之间进行⼴播 称为 直接⼴播</font></li>
</ul>
<p>  例如⽹络地址为 192.168.0.0&#x2F;24 的主机向 192.168.1.255&#x2F;24 的⽬标地址发送 IP 包。收到这个包的路由器，将数据转发给 192.168.1.0&#x2F;24，从⽽使得所有 192.168.1.1~192.168.1.254 的主机都能收到这个包（由于直接⼴播有⼀定的安全问题，多数情况 下会在路由器上设置为不转发。） 。</p>
<h3 id="IP地址分类优劣"><a href="#IP地址分类优劣" class="headerlink" title="IP地址分类优劣"></a>IP地址分类优劣</h3><h4 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h4><p>简单明了、选路（基于⽹络地址）简单，通过判断首位是0还是1就能 快速找出 ⽹络地址和主机地址。</p>
<p>其余分类判断⽅式参考如下：</p>
<p>第一位为：</p>
<ul>
<li>0：A类地址</li>
<li>1：第二位为：<ul>
<li>0：B类地址</li>
<li>1：第三位为：<ul>
<li>0：C类地址</li>
<li>1：第四位：<ul>
<li>0：D类地址</li>
<li>1：E类地址</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h4><ol>
<li>同一网络下没有地址层次。</li>
<li>A、B、C类不能很好与现实网络匹配。</li>
</ol>
<p>以上两个缺点都可以 通过使用 CIDR无分类地址 来解决。</p>
<h2 id="CIDR（无分类IP地址）"><a href="#CIDR（无分类IP地址）" class="headerlink" title="CIDR（无分类IP地址）"></a>CIDR（无分类IP地址）</h2><h3 id="CIDR简介"><a href="#CIDR简介" class="headerlink" title="CIDR简介"></a>CIDR简介</h3><p> <font color='orange'>正因为 IP 分类存在许多缺点，所以提出⽆分类地址⽅案，即 CIDR。</font></p>
<p> <font color='orange'>CIDR不再分类地址，32 ⽐特的 IP 被划分为两部分：前⾯是⽹络号，后⾯是主机号。</font></p>
<h3 id="网络号和主机号划分"><a href="#网络号和主机号划分" class="headerlink" title="网络号和主机号划分"></a>网络号和主机号划分</h3><p> <font color='orange'>无分类地址格式为：a.b.c.d&#x2F;x ，其中 &#x2F;x 表示前 x 位属于⽹络号， x 的范围是 0 ~ 32 ，这使得 IP 地址更加灵活。</font></p>
<p>⽐如 10.100.122.2&#x2F;24，就是无分类地址，&#x2F;24 表示前 24 位是⽹络号，剩余的 8 位是主机号。</p>
<p><img src="https://raw.githubusercontent.com/lucky2shh/blog-haogeblogs-image/master/2023/08/05/image-20210415211145547.png?token=AIGEF3MW3M2R7E7OPP4GDDLEZZQRA" alt="image-20210415211145547"></p>
<p> <font color='orange'>另⼀种 划分⽹络号与主机号 的方式是 ⼦⽹掩码，掩码就是掩盖掉主机号，剩下的是⽹络号。</font> </p>
<p>对⼦⽹掩码和IP地址进行 与运算 可得到⽹络号。</p>
<p><img src="https://raw.githubusercontent.com/lucky2shh/blog-haogeblogs-image/master/2023/08/05/image-20210415211234778.png?token=AIGEF3LH7MQRN5FCSP6MA5TEZZQSO" alt="image-20210415211234778"></p>
<p><strong>为何划分网络号和主机号</strong></p>
<p> <font color='orange'>因为 两台计算机想通讯就得先判断是否处于同⼀个⼴播域内，即⽹络地址是否相同。如果⽹络地址相同，表明接受⽅在本⽹络上且可以把数据包直接发送到⽬标主机。</font></p>
<p>路由器寻址 就是采用该方式来 找到 对应⽹络号，进⽽把 数据包 转发给 对应⽹络。</p>
<p><img src="https://raw.githubusercontent.com/lucky2shh/blog-haogeblogs-image/master/2023/08/05/image-20210415211525393.png?token=AIGEF3OOIFHUZG5TUUCS7C3EZZQT6" alt="image-20210415211525393"></p>
<h3 id="子网划分"><a href="#子网划分" class="headerlink" title="子网划分"></a>子网划分</h3><h4 id="何为子网划分"><a href="#何为子网划分" class="headerlink" title="何为子网划分"></a>何为子网划分</h4><p> <font color='orange'>⼦⽹掩码可以划分出 ⽹络号 和 主机号，还可划分 ⼦⽹。</font></p>
<p>⼦⽹划分实际上是将主机地址分为两个部分：⼦⽹⽹络地址 和 ⼦⽹主机地址。形式如下：</p>
<p><img src="https://raw.githubusercontent.com/lucky2shh/blog-haogeblogs-image/master/2023/08/05/image-20210415211605113.png?token=AIGEF3OF4XRSSKC4YOE264TEZZQVG" alt="image-20210415211605113"></p>
<ul>
<li>未做⼦⽹划分的 ip 地址：⽹络地址＋主机地址。</li>
<li>做⼦⽹划分后的 ip 地址：⽹络地址＋（⼦⽹⽹络地址＋⼦⽹主机地址）。</li>
</ul>
<h4 id="子网划分原理"><a href="#子网划分原理" class="headerlink" title="子网划分原理"></a>子网划分原理</h4><p>假设对 C 类地址进⾏⼦⽹划分，⽹络地址 192.168.1.0，使⽤⼦⽹掩码 255.255.255.192 对其进⾏⼦⽹划分。 </p>
<p>C 类地址中前 24 位是⽹络号，最后 8 位是主机号，根据⼦⽹掩码可知从 8 位主机号中借⽤ 2 位作为⼦⽹号。</p>
<p><img src="https://raw.githubusercontent.com/lucky2shh/blog-haogeblogs-image/master/2023/08/05/image-20210415211738776.png?token=AIGEF3OS6ZLP5TWZTLUPFGTEZZQW6" alt="image-20210415211738776"></p>
<p>由于⼦⽹⽹络地址被划分成 2 位，那么⼦⽹地址就有 4 个，分别是 00、01、10、11，具体划分如下图：</p>
<p><strong>子网0</strong></p>
<p><img src="https://raw.githubusercontent.com/lucky2shh/blog-haogeblogs-image/master/2023/08/05/image-20210415211918539.png?token=AIGEF3IMMEMW2YLE2D7BTKTEZZQYI" alt="image-20210415211918539"></p>
<p><strong>子网1</strong></p>
<p><img src="https://raw.githubusercontent.com/lucky2shh/blog-haogeblogs-image/master/2023/08/05/image-20210415211943850.png?token=AIGEF3NSSLF5SWJLFMRDNCDEZZQZO" alt="image-20210415211943850"></p>
<p><strong>子网2</strong></p>
<p><img src="https://raw.githubusercontent.com/lucky2shh/blog-haogeblogs-image/master/2023/08/05/image-20210415212003104.png?token=AIGEF3L3DMCNVCSMHFSNBULEZZQ2Y" alt="image-20210415212003104"></p>
<p><strong>子网3</strong></p>
<p><img src="https://raw.githubusercontent.com/lucky2shh/blog-haogeblogs-image/master/2023/08/05/image-20210415212019344.png?token=AIGEF3LMLOBOWT7Z44SCGFLEZZQ4U" alt="image-20210415212019344"></p>
<p>划分后的 4 个⼦⽹如下表格：</p>
<p><img src="https://raw.githubusercontent.com/lucky2shh/blog-haogeblogs-image/master/2023/08/05/image-20210415212042823.png?token=AIGEF3OGGMZ55NXLKN4PIOLEZZQ56" alt="image-20210415212042823"></p>
<h2 id="公有IP地址与私有IP地址"><a href="#公有IP地址与私有IP地址" class="headerlink" title="公有IP地址与私有IP地址"></a>公有IP地址与私有IP地址</h2><h3 id="公私IP地址简介"><a href="#公私IP地址简介" class="headerlink" title="公私IP地址简介"></a>公私IP地址简介</h3><p> <font color='orange'>在 A、B、C 类地址中，可分为公有 IP 地址和私有 IP 地址。</font></p>
<p><img src="https://raw.githubusercontent.com/lucky2shh/blog-haogeblogs-image/master/2023/08/05/image-20210415212322287.png?token=AIGEF3LLTM5WE655PPH2TBDEZZQ7E" alt="image-20210415212322287"></p>
<p>每个⼩区都有⾃⼰的楼编号和⻔牌号，你⼩区家可以叫 1 栋 101 号，我⼩区家也可以叫 1 栋 101，没有任何问题。但⼀旦出了⼩区，就需要带上中⼭路 666 号（公⽹ IP 地址），是国家统⼀分配 的，不能两个⼩区都叫中⼭路 666。</p>
<p>所以，公有 IP 地址是有个组织统⼀分配的，假设你要开⼀个博客⽹站，那么你就需要去申请购买⼀个 公有 IP，这样全世界的⼈才能访问。并且公有 IP 地址基本上要在整个互联⽹范围内保持唯⼀。</p>
<h3 id="公私IP地址管理机构"><a href="#公私IP地址管理机构" class="headerlink" title="公私IP地址管理机构"></a>公私IP地址管理机构</h3><p>私有 IP 地址通常 由 内部IT⼈员管理，公有 IP 由 ICANN 组织管理，中⽂叫「互联⽹名称与数字地址分配机构」。</p>
<p> <font color='orange'>IANA 是 ICANN中的⼀个机构，它负责分配互联⽹ IP 地址，是按州的⽅式层层分配。</font></p>
<p><img src="https://raw.githubusercontent.com/lucky2shh/blog-haogeblogs-image/master/2023/08/05/image-20210415212554129.png?token=AIGEF3INVAPZ7KYF2BGKFUDEZZRAM" alt="image-20210415212554129"></p>
<ul>
<li>ARIN 北美地区</li>
<li>LACNIC 拉丁美洲和⼀些加勒⽐群岛</li>
<li>RIPE NCC 欧洲、中东和中亚</li>
<li>AfriNIC ⾮洲地区</li>
<li>APNIC 亚太地区</li>
</ul>
<p> <font color='orange'>在中国由 CNNIC 机构管理，它是国内唯⼀指定的全局 IP 地址管理组织。</font></p>
<h2 id="IP地址与路由控制"><a href="#IP地址与路由控制" class="headerlink" title="IP地址与路由控制"></a>IP地址与路由控制</h2><p> <font color='orange'>IP地址的 ⽹络地址 部分⽤于进⾏路由控制。</font></p>
<p>路由控制表中记录着⽹络地址与下⼀步应该发送⾄路由器的地址。在主机和路由器上都会有各⾃的路由器控制表。</p>
<p> <font color='orange'>发送 IP 包时 要先 确定 IP 包⾸部中的⽬标地址，再从路由控制表中找到与该地址具有相同⽹络地址的记录，根据该记录将 IP 包转发给相应的下⼀个路由器。如果路由控制表中存在多条相同⽹络地址 的记录，就选择相同位数最多的⽹络地址，也就是最⻓匹配。</font></p>
<p><img src="https://raw.githubusercontent.com/lucky2shh/blog-haogeblogs-image/master/2023/08/05/image-20210415212845042.png?token=AIGEF3JRGQDXS5ZBBAVNZHDEZZRCI" alt="image-20210415212845042"></p>
<ol>
<li>主机 A 要发送⼀个 IP 包，其源地址是 10.1.1.30 和⽬标地址是 10.1.2.10 ，由于没有在主机 A 的路由表找到与⽬标地址 10.1.2.10 的⽹络地址，于是包被转发到默认路由（路由器 1 ）。</li>
<li>路由器 1 收到 IP 包后，也在路由器 1 的路由表匹配与⽬标地址相同的⽹络地址记录，发现匹配 到了，于是就把 IP 数据包转发到了 10.1.0.2 这台路由器 2。</li>
<li>路由器 2 收到后，同样对⽐⾃身的路由表，发现匹配到了，于是把 IP 包从路由器 2 的 10.1.2.1 这个接⼝出去，最终经过交换机把 IP 数据包转发到了⽬标主机。</li>
</ol>
<h3 id="环回地址"><a href="#环回地址" class="headerlink" title="环回地址"></a>环回地址</h3><p>环回地址 是在同⼀台计算机上的程序之间进⾏⽹络通信时所使⽤的默认地址。</p>
<p>计算机使⽤ 127.0.0.1 作为环回地址，与之相同的是主机名 localhost 。使⽤这个 IP 或主机名时，数据包不会流向⽹络。</p>
<h2 id="IP分片与重组"><a href="#IP分片与重组" class="headerlink" title="IP分片与重组"></a>IP分片与重组</h2><p>每种数据链路的最⼤传输单元 MTU 都不相同，如 FDDI 数据链路 MTU 为 4352、以太⽹ MTU 为 1500 字节等。</p>
<p>每种数据链路的 MTU 之所以不同，是因为不同类型的数据链路 其 使⽤⽬的不同，故可承载的 MTU 也就不同。</p>
<p> <font color='orange'>最常⻅的数据链路是以太⽹，它的 MTU 是 1500 字节。</font></p>
<p>当 IP 数据包⼤⼩⼤于 MTU 时， IP 数据包会被分⽚，分⽚后的 IP 数据包在被重组时，只能由⽬标主机进⾏，路由器不会进⾏重组。</p>
<p>假设发送⽅发送⼀个 4000 字节的⼤数据报，若要传输在以太⽹链路，则需要把数据报分⽚成 3 个⼩数 据报进⾏传输，再交由接收⽅重组成⼤数据报。</p>
<p><img src="https://raw.githubusercontent.com/lucky2shh/blog-haogeblogs-image/master/2023/08/05/image-20210415213617493.png?token=AIGEF3PKCDQC4T4KGH7OOV3EZZRDQ" alt="image-20210415213617493"></p>
<p>分⽚传输中，⼀旦某个分⽚丢失，会导致整个 IP 数据包作废，所以 TCP 引⼊了 MSS 也就是在 TCP 层进⾏分⽚而不在 IP 层分⽚，那么对于 UDP 我们尽量不要发送⼀个⼤于 MTU 的数据报⽂。</p>
<h2 id="IPV6基本认识"><a href="#IPV6基本认识" class="headerlink" title="IPV6基本认识"></a>IPV6基本认识</h2><h3 id="IPV6简介"><a href="#IPV6简介" class="headerlink" title="IPV6简介"></a>IPV6简介</h3><p> <font color='orange'>IPv4 地址是 32 位，⼤约有 43 亿个地址，但早在 2011 年 IPv4 地址就已经被分配完了。</font></p>
<p> <font color='orange'>IPv6 地址是 128 位，可分配地址数量非常多，且还有更好的安全性和扩展性</font>。</p>
<p>因IPv4 和 IPv6 不兼容，且IPV6要求电脑、手机要适配，也需要网络运营商的支持，所以ipv6普及较慢。</p>
<h3 id="IPV6亮点"><a href="#IPV6亮点" class="headerlink" title="IPV6亮点"></a>IPV6亮点</h3><p>IPv6 除了地址多，还有很多其它亮点：</p>
<ol>
<li><font color='orange'>IPv6 可⾃动配置，即使没有 DHCP 服务器也可实现 IP地址⾃动分配。</font></li>
<li><font color='orange'>IPv6 包头包⾸部⻓度固定为40 字节，去掉了包头校验，简化了⾸部结构，减轻了路由器负荷，⼤⼤提⾼了传输性能。</font></li>
<li><font color='orange'>IPv6 有防⽌线路窃听等功能，提升了安全性。</font></li>
</ol>
<h3 id="IPV6地址表示法"><a href="#IPV6地址表示法" class="headerlink" title="IPV6地址表示法"></a>IPV6地址表示法</h3><p>IPv4 地址⻓度共 32 位，是以每 8 位作为⼀组，并⽤点分⼗进制的表示⽅式。</p>
<p> <font color='orange'>IPv6 ⻓度 128 位，每 16 位为⼀组，每组⽤冒号 : 隔开。</font></p>
<p><img src="https://raw.githubusercontent.com/lucky2shh/blog-haogeblogs-image/master/2023/08/05/image-20210415213924099.png?token=AIGEF3NGU6KHIWBVZYN3B4TEZZREW" alt="image-20210415213924099"></p>
<p>如果出现连续的0时还可以将这些 0 省略，并⽤两个冒号 「::」隔开。但是，⼀个 IP 地址中只允许出 现⼀次两个连续的冒号。</p>
<p><img src="https://raw.githubusercontent.com/lucky2shh/blog-haogeblogs-image/master/2023/08/05/image-20210415213947044.png?token=AIGEF3NLTJC54KGPO75DZITEZZRF2" alt="image-20210415213947044"></p>
<h3 id="IPV6地址结构"><a href="#IPV6地址结构" class="headerlink" title="IPV6地址结构"></a>IPV6地址结构</h3><p>IPv6 类似 IPv4，同样采取IP地址前⼏位来标识 IP 地址的种类。</p>
<p>IPv6 地址主要有以下类型地址：</p>
<ul>
<li>单播地址，⽤于⼀对⼀的通信。</li>
<li>组播地址，⽤于⼀对多的通信。</li>
<li>任播地址，⽤于通信最近的节点，最近的节点是由路由协议决定。</li>
<li>没有⼴播地址。</li>
</ul>
<p><img src="https://raw.githubusercontent.com/lucky2shh/blog-haogeblogs-image/master/2023/08/05/image-20210415214100341.png?token=AIGEF3IO2DLR7L53D6QTLSLEZZRHO" alt="image-20210415214100341"></p>
<h3 id="IPV6单播地址类型"><a href="#IPV6单播地址类型" class="headerlink" title="IPV6单播地址类型"></a>IPV6单播地址类型</h3><p>IPv6 地址主要分三类单播地址，每类地址有效范围都不同： </p>
<ul>
<li>同⼀链路单播通信，不经过路由器，可以使⽤链路本地单播地址，IPv4 没有此类型。</li>
<li>在内⽹⾥单播通信，可以使⽤唯⼀本地地址，相当于 IPv4 的私有 IP。</li>
<li>在互联⽹通信，可以使⽤全局单播地址，相当于 IPv4 的公有 IP。</li>
</ul>
<p><img src="https://raw.githubusercontent.com/lucky2shh/blog-haogeblogs-image/master/2023/08/05/image-20210415214210802.png?token=AIGEF3NZH6JIPHBJQBXNYZLEZZRI6" alt="image-20210415214210802"></p>
<h2 id="IPV4首部与IPV6首部"><a href="#IPV4首部与IPV6首部" class="headerlink" title="IPV4首部与IPV6首部"></a>IPV4首部与IPV6首部</h2><p>IPv4 与 IPv6 ⾸部差异如下：</p>
<p><img src="https://raw.githubusercontent.com/lucky2shh/blog-haogeblogs-image/master/2023/08/05/image-20210415214300627.png?token=AIGEF3JL3ZQSBAJ4BXGH7F3EZZRKE" alt="image-20210415214300627"></p>
<p>IPv6 与 IPv4相比，其⾸部改进如下： </p>
<ol>
<li><font color='orange'>取消了⾸部校验和字段。</font> 因为在数据链路层和传输层都会校验，因此 IPv6 直接取消了 IP 的校验。</li>
<li><font color='orange'>取消了分⽚&#x2F;重新组装相关字段。</font> 分⽚与重组是耗时的过程，IPv6不允许在中间路由器进⾏分⽚与重组，这种操作只能在源与⽬标主机，这将⼤⼤提⾼路由器转发速度。</li>
<li><font color='orange'>取消选项字段。</font>选项字段不再是标准 IP ⾸部的⼀部分，但它并没有消失，⽽是可能出现在 IPv6 ⾸部中的「下⼀个⾸部」指出的位置上。删除该选项字段使的 IPv6 的⾸部成为固定⻓度的 40 字 节。</li>
</ol>
<h1 id="IP协议相关技术"><a href="#IP协议相关技术" class="headerlink" title="IP协议相关技术"></a>IP协议相关技术</h1><h2 id="DNS域名解析"><a href="#DNS域名解析" class="headerlink" title="DNS域名解析"></a>DNS域名解析</h2><p>我们访问网站时，其网址通常是域名，而并非是IP地址，因为域名更便于理解和接受。</p>
<p>实现这⼀技术的就是 DNS 域名解析， <font color='orange'>DNS 可将域名⽹址⾃动转换为 IP地址。</font></p>
<p>DNS 中的域名都是⽤句点来分隔，⽐如<code>www.server.com</code> ，这⾥的句点代表了不同层次之间的界限。</p>
<p> <font color='orange'>域名中，越靠右的位置表示其层级越⾼，所以域名的层级关系类似⼀个树状结构</font>： </p>
<ul>
<li>根 DNS 服务器</li>
<li>顶级域 DNS 服务器（com）</li>
<li>权威 DNS 服务器（server.com）</li>
</ul>
<p><img src="https://raw.githubusercontent.com/lucky2shh/blog-haogeblogs-image/master/2023/08/05/image-20210415214715046.png?token=AIGEF3PW6RHL2TMR6FN4UQDEZZRLC" alt="image-20210415214715046"></p>
<p>根域 DNS 服务器信息保存在互联⽹中的所有 DNS 服务器中。这样⼀来，任何 DNS 服务器就都可以找到并访问根域 DNS 服务器。</p>
<p>因此，客户端只要能够找到任意⼀台 DNS 服务器，就可以通过它找到根域 DNS 服务器，然后再⼀路顺藤摸⽠找到位于下层的某台⽬标 DNS 服务器。</p>
<h3 id="域名解析流程"><a href="#域名解析流程" class="headerlink" title="域名解析流程"></a>域名解析流程</h3><p><font color='orange'>浏览器会先看自己的缓存，没有就看系统缓存，还没有就检查本机域名解析⽂件 hosts ，如果还没有，就会通过 DNS 服务器来查询。</font></p>
<p>DNS服务器查询过程如下：</p>
<ol>
<li>客户端⾸先会发出⼀个 DNS 请求，问 <a target="_blank" rel="noopener" href="http://www.server.com/">www.server.com</a> 的 IP 是啥，并发给本地 DNS 服务器（也就是客户端的 TCP&#x2F;IP 设置中填写的 DNS 服务器地址）。</li>
<li>本地域名服务器收到客户端的请求后，如果缓存⾥的表格能找到 <a target="_blank" rel="noopener" href="http://www.server.com,则它直接返回/">www.server.com，则它直接返回</a> IP 地址。如果没有，本地 DNS 会去问它的根域名服务器：“⽼⼤， 能告诉我 <a target="_blank" rel="noopener" href="http://www.server.com/">www.server.com</a> 的 IP 地址吗？” 根域名服务器是最⾼层次的，它不直接⽤于域名解析，但能指明⼀条道路。</li>
<li>根 DNS 收到来⾃本地 DNS 的请求后，发现后置是 .com，说：“<a target="_blank" rel="noopener" href="http://www.server.com/">www.server.com</a> 这个域名归 .com 区域管理”，我给你 .com 顶级域名服务器地址，你去问它吧。”</li>
<li>本地 DNS 收到顶级域名服务器的地址后，发起请求问“⽼⼆， 你能告诉我 <a target="_blank" rel="noopener" href="http://www.server.com/">www.server.com</a> 的 IP 地址吗？” </li>
<li>顶级域名服务器说：“我给你负责 <a target="_blank" rel="noopener" href="http://www.server.com/">www.server.com</a> 区域的权威 DNS 服务器的地址，你去问它应该 能问到”。</li>
<li>本地 DNS 于是转向问权威 DNS 服务器：“⽼三，<a href="http://www.server.com对应的IP是啥呀？”">www.server.com对应的IP是啥呀？”</a> server.com 的权威 DNS 服务器，它是域名解析结果的原出处。为啥叫权威呢？就是我的域名我做主。</li>
<li>权威 DNS 服务器查询后将对应的 IP 地址 X.X.X.X 告诉本地 DNS。</li>
<li>本地 DNS 再将 IP 地址返回客户端，客户端和⽬标建⽴连接。</li>
</ol>
<p>⾄此，我们完成了 DNS 解析过程。现在总结⼀下，整个过程我画成了⼀个图。</p>
<p><img src="https://raw.githubusercontent.com/lucky2shh/blog-haogeblogs-image/master/2023/08/05/image-20210415214931845.png?token=AIGEF3NVX3DKRC64RYSAHELEZZRMM" alt="image-20210415214931845"></p>
<h2 id="ARP与RARP协议（网络接口层）"><a href="#ARP与RARP协议（网络接口层）" class="headerlink" title="ARP与RARP协议（网络接口层）"></a>ARP与RARP协议（网络接口层）</h2><h3 id="ARP协议"><a href="#ARP协议" class="headerlink" title="ARP协议"></a>ARP协议</h3><p>在传输⼀个 IP 数据报时，确定了源 IP 地址和⽬标 IP 地址后，就会通过主机「路由表」确定 IP 数据包下⼀跳。然⽽，⽹络层的下⼀层是数据链路层，所以我们还要知道「下⼀跳」的 MAC 地址。</p>
<p> <font color='orange'>通过主机路由表可找到下⼀跳 IP 地址，根据 IP地址 和 ARP 协议，可得知下⼀跳 MAC 地址。</font></p>
<p>ARP 如何知道 对⽅MAC地址呢？</p>
<p>ARP 是借助 ARP 请求与 ARP 响应 两种类型的包 来确定 MAC 地址。</p>
<p><img src="https://raw.githubusercontent.com/lucky2shh/blog-haogeblogs-image/master/2023/08/05/image-20230805101102458.png?token=AIGEF3JXOV3NUCG7MPNDC33EZZRNY" alt="image-20230805101102458"></p>
<ul>
<li><font color='orange'>主机会通过⼴播发送 ARP 请求，这个包中包含了想要知道 MAC 地址的主机 IP 地址。</font></li>
<li>当同个链路中的所有设备收到 ARP 请求时，会去拆开 ARP 请求包⾥的内容，如果 ARP 请求包中的⽬标 IP 地址与⾃⼰的 IP 地址⼀致，那么这个设备就将⾃⼰的 MAC 地址塞⼊ ARP 响应包返回给主机。</li>
</ul>
<p> <font color='orange'>操作系统通常会把第⼀次通过 ARP 获取的 MAC 地址缓存起来，以便下次直接从缓存中拿。</font></p>
<p> <font color='red'>注意：MAC 地址缓存有时间限制，超过限定时间将清除已缓存内容。</font></p>
<h3 id="RARP协议"><a href="#RARP协议" class="headerlink" title="RARP协议"></a>RARP协议</h3><p> <font color='orange'>ARP 协议是已知 IP 地址求 MAC 地址， RARP 则是已知 MAC 地址求 IP 地址</font>。例如 将打印机服务器等⼩型嵌⼊式设备接⼊到⽹络时就经常会⽤得到。</p>
<p>通常需要架设⼀台 RARP 服务器，在这个服务器上注册设备的 MAC 地址及其 IP 地址。然后再将这个设备接⼊到⽹络，接着：</p>
<ul>
<li>该设备会发送⼀条「我的 MAC 地址是XXXX，请告诉我，我的IP地址应该是什么」的请求信息。</li>
<li>RARP 服务器接到这个消息后返回「MAC地址为 XXXX 的设备，IP地址为 XXXX」的信息给这个设备。</li>
</ul>
<p>最后，设备会从 RARP 服务器所收到的应答信息中找到IP地址并进行设置。</p>
<p><img src="https://raw.githubusercontent.com/lucky2shh/blog-haogeblogs-image/master/2023/08/05/image-20210415215304596.png?token=AIGEF3PFAKEMEZ6GJ2PNKLTEZZRPE" alt="image-20210415215304596"></p>
<h2 id="DHCP动态获取IP地址"><a href="#DHCP动态获取IP地址" class="headerlink" title="DHCP动态获取IP地址"></a>DHCP动态获取IP地址</h2><p>我们的电脑通常都是通过 DHCP 动态获取 IP 地址，⼤⼤省去了配 IP 信息繁琐的过程。</p>
<p>接下来，我们来看看电脑是如何通过 4 个步骤获取到 IP。</p>
<p> <font color='red'>注意：DHCP 客户端进程监听的是 68 端⼝号，DHCP 服务端进程监听的是 67 端⼝号。</font></p>
<p>4 个步骤如下：</p>
<ol>
<li>客户端⾸先发起 DHCP 发现报⽂（DHCP DISCOVER） 的 IP 数据报，由于客户端没有 IP 地址， 也不知道 DHCP 服务器的地址，所以使⽤的是 UDP ⼴播通信，其使⽤的⼴播⽬的地址是 255.255.255.255（端⼝ 67） 并且使⽤ 0.0.0.0（端⼝ 68） 作为源 IP 地址。DHCP 客户端将该 IP 数据报传递给链路层，然后链路层将帧⼴播到⽹络中的所有设备。</li>
<li>DHCP 服务器收到 DHCP 发现报⽂时，⽤ DHCP 提供报⽂（DHCP OFFER） 向客户端做出响应。该报⽂仍然使⽤ IP ⼴播地址 255.255.255.255，该报⽂信息携带服务器提供可租约的 IP 地址、⼦⽹掩码、默认⽹关、DNS 服务器以及 IP 地址租⽤期。</li>
<li>客户端收到⼀个或多个服务器的 DHCP 提供报⽂后，从中选择⼀个服务器，并向选中的服务器发送 DHCP 请求报⽂（DHCP REQUEST进⾏响应，回显配置的参数。</li>
<li>最后，服务端⽤ DHCP ACK 报⽂对 DHCP 请求报⽂进⾏响应，应答所要求的参数。</li>
</ol>
<p>⼀旦客户端收到 DHCP ACK 后，交互便完成了，并且客户端能够在租⽤期内使⽤ DHCP 服务器分配的 IP 地址。</p>
<p>如果租约的 DHCP IP 地址快过期了，客户端会向服务器发送 DHCP 请求报⽂：</p>
<ul>
<li>服务器如果同意继续租⽤，则⽤ DHCP ACK 报⽂进⾏应答，客户端就会延⻓租期。</li>
<li>服务器如果不同意继续租⽤，则⽤ DHCP NACK 报⽂，客户端就要停⽌使⽤租约的 IP 地址。</li>
</ul>
<p>可以发现， <font color='orange'>DHCP 交互中，全程都是使⽤ UDP ⼴播通信。</font> </p>
<p>咦，⽤的是⼴播，那如果 DHCP 服务器和客户端不是在同⼀个局域⽹内，路由器⼜不会转发⼴播包，那不是每个⽹络都要配⼀个 DHCP 服务器？ </p>
<p>为解决该问题，就出现了 <strong>DHCP 中继代理</strong>。 <font color='orange'>有了 DHCP 中继代理以后，对不同⽹段的 IP 地址分配可以由⼀个 DHCP 服务器统⼀进⾏管理。</font></p>
<p><img src="https://raw.githubusercontent.com/lucky2shh/blog-haogeblogs-image/master/2023/08/05/image-20210415220738058.png?token=AIGEF3M4XEWKNO7CH3ICLN3EZZRQC" alt="image-20210415220738058"></p>
<ul>
<li>DHCP 客户端会向 DHCP 中继代理发送 DHCP 请求包，⽽ DHCP 中继代理在收到这个⼴播包以后，再以单播的形式发给 DHCP 服务器。</li>
<li>服务器端收到该包以后再向 DHCP 中继代理返回应答，并由 DHCP 中继代理将此包⼴播给 DHCP 客户端 。</li>
</ul>
<p> 因此，DHCP 服务器即使不在同⼀个链路上也可以实现统⼀分配和管理IP地址。</p>
<h2 id="NAT（网络地址转换）"><a href="#NAT（网络地址转换）" class="headerlink" title="NAT（网络地址转换）"></a>NAT（网络地址转换）</h2><h3 id="NAT作用"><a href="#NAT作用" class="headerlink" title="NAT作用"></a>NAT作用</h3><p>IPv4 地址紧缺，故提出了 ⽹络地址转换方案 NAT，作用就是： <font color='orange'>将 私有IP地址 转换成 公有IP地址。</font></p>
<p><img src="https://raw.githubusercontent.com/lucky2shh/blog-haogeblogs-image/master/2023/08/05/image-20210415220931123.png?token=AIGEF3K22S7HJNVL27DCCADEZZRRC" alt="image-20210415220931123"></p>
<p>思考：若这样，那不是 N 个私有 IP 地址，就需要 N 个公有 IP 地址？这怎么就缓解 IPv4 地址耗尽问题？ </p>
<p>确实是， <font color='orange'>普通 NAT转换没什么意义。由于绝⼤多数⽹络应⽤都使⽤传输层协议 TCP 或 UDP 来传输数据。 因此，可以把 IP 地址 + 端⼝号⼀起进⾏转换，这种转换技术叫 ⽹络地址与端⼝转换 NAPT。</font></p>
<p>很抽象？来，看下⾯的图解就能瞬间明⽩了。</p>
<p><img src="https://raw.githubusercontent.com/lucky2shh/blog-haogeblogs-image/master/2023/08/05/image-20210415221031683.png?token=AIGEF3IKC3ZSXCNDBMPTHTDEZZRSG" alt="image-20210415221031683"></p>
<p>图中有两个客户端 192.168.1.10 和 192.168.1.11 同时与服务器 183.232.231.172 进⾏通信，且两个客户端本地端⼝都是 1025。此时，两个私有 IP 地址将转换为公有地址 120.229.175.121，但是以不同的端⼝号作为区分。</p>
<p>于是，⽣成⼀个 NAPT 路由器转换表，就可以正确转换 地址与端⼝组合，令客户端 A、B 能同时与服务器之间进⾏通信。</p>
<p>这种转换表在 NAT 路由器上⾃动⽣成。例如，建⽴ TCP 连接⾸次握⼿时的 SYN 包 ⼀经发出，就会⽣成这个表。⽽后⼜随着收到关闭连接时发出 FIN 包的确认应答而从表中删除。</p>
<h3 id="NAT缺陷"><a href="#NAT缺陷" class="headerlink" title="NAT缺陷"></a>NAT缺陷</h3><p>因为 NAT&#x2F;NAPT 依赖⾃⼰的转换表，因此会有以下问题：</p>
<ol>
<li>外部⽆法主动与 NAT 内部服务器建⽴连接，因为 NAPT 转换表没有转换记录。</li>
<li>转换表的⽣成与转换操作都会产⽣性能开销。</li>
<li>通信过程中，如果 NAT 路由器重启了，所有TCP 连接都将被重置。</li>
</ol>
<h3 id="如何解决缺陷"><a href="#如何解决缺陷" class="headerlink" title="如何解决缺陷"></a>如何解决缺陷</h3><ol>
<li><font color='orange'>改用IPV6</font></li>
</ol>
<p>   IPv6 可⽤范围⾮常⼤，每台设备都可配置⼀个公有 IP 地址，但 IPv6 普及还需要时间。</p>
<ol start="2">
<li><p><font color='orange'>NAT穿透技术</font></p>
<p><font color='orange'>NAT 穿透技术能够让⽹络应⽤程序主动发现⾃⼰位于 NAT 设备之后，并会主动获得 NAT 设备的公有 IP，并为⾃⼰建⽴端⼝映射条⽬，注意这些都由 NAT设备后的应⽤程序⾃动完成。</font></p>
</li>
</ol>
<p>   也就是说，在 NAT 穿透技术中，NAT设备后的应⽤程序处于主动地位，它已经明确地知道 NAT 设备要修改它外发的数据包，于是它主动配合 NAT 设备的操作，主动地建⽴好映射，这样就减少了NAT设备的工作。</p>
<p>   说⼈话，就是客户端主动从 NAT 设备获取公网 IP 地址，然后⾃⼰建⽴端⼝映射条⽬，然后⽤这个条⽬ 对外通信，就不需要 NAT 设备来进⾏转换了。</p>
<h2 id="ICMP（互联网控制报文协议-网络层）"><a href="#ICMP（互联网控制报文协议-网络层）" class="headerlink" title="ICMP（互联网控制报文协议 &#x2F; 网络层）"></a>ICMP（互联网控制报文协议 &#x2F; 网络层）</h2><h3 id="ICMP简介"><a href="#ICMP简介" class="headerlink" title="ICMP简介"></a>ICMP简介</h3><p> <font color='orange'>ICMP 全称是 Internet Control Message Protocol，也叫 互联⽹控制报⽂协议。</font></p>
<p>⾥⾯有个关键词 —— 控制，如何控制呢？</p>
<p>⽹络包 在 复杂⽹络传输中 会遇到各种问题。 当遇到问题时 需要 传出消息 并 报告异常问题，这样可以 调整传输策略 来控制 整个局⾯。</p>
<h3 id="ICMP功能"><a href="#ICMP功能" class="headerlink" title="ICMP功能"></a>ICMP功能</h3><p> <font color='orange'>ICMP 主要功能包括：确认 IP 包是否成功送达⽬标地址、报告发送过程中 IP 包被废弃的原因和改善⽹络设置等。</font></p>
<p>在 IP 通信中如果某个 IP 包因为某种原因未能达到⽬标地址，那么这个具体的原因将由 ICMP 负责通知。</p>
<p><img src="https://raw.githubusercontent.com/lucky2shh/blog-haogeblogs-image/master/2023/08/05/image-20210415221514890.png?token=AIGEF3PYUGAL34ICWISTU5LEZZRTM" alt="image-20210415221514890"></p>
<p>如上图，主机 A发送数据包 给 主机B，但因为某些原因 导致 路由器 2 不能找到主机B，此时路由器 2 通过 IP 向主机 A 发送⼀个 ICMP ⽬标不可达数据包。</p>
<p> <font color='orange'>ICMP 的这种通知消息会使⽤ IP 进⾏发送 。</font></p>
<p>因此，从路由器 2 返回的 ICMP 包会按照往常的路由控制先经过路由器 1 再转发给主机 A 。收到该 ICMP 包的主机 A 则分解 ICMP 的⾸部和数据域以后得知具体发⽣问题的原因。</p>
<h3 id="ICMP类型"><a href="#ICMP类型" class="headerlink" title="ICMP类型"></a>ICMP类型</h3><p>ICMP ⼤致可以分为两⼤类：</p>
<ul>
<li>⽤于诊断的查询消息，也就是「查询报⽂类型」。</li>
<li>通知出错原因的错误消息，也就是「差错报⽂类型」。</li>
</ul>
<p><img src="https://raw.githubusercontent.com/lucky2shh/blog-haogeblogs-image/master/2023/08/05/image-20210415221644966.png?token=AIGEF3J4SSES4SWPSTY7A6LEZZRUQ" alt="image-20210415221644966"></p>
<h2 id="IGMP（因特网组管理协议-网络层）"><a href="#IGMP（因特网组管理协议-网络层）" class="headerlink" title="IGMP（因特网组管理协议 &#x2F; 网络层）"></a>IGMP（因特网组管理协议 &#x2F; 网络层）</h2><h3 id="IGMP简介"><a href="#IGMP简介" class="headerlink" title="IGMP简介"></a>IGMP简介</h3><p>ICMP 与 IGMP ⼀点关系都没有，就好比 周杰 与 周杰伦 的区别。</p>
<p>组播地址 说的是 只有在⼀组的主机才能收到数据包，那么如何确定是否在⼀个组呢？这需要 IGMP协议 来协助。</p>
<p><img src="https://raw.githubusercontent.com/lucky2shh/blog-haogeblogs-image/master/2023/08/05/image-20210415221723705.png?token=AIGEF3MF22JJES33IHDA7EDEZZRVS" alt="image-20210415221723705"></p>
<p>IGMP 是因特⽹组管理协议，⼯作在主机（组播成员）和最后⼀跳路由之间，如上图中蓝⾊部分。 </p>
<ul>
<li>IGMP 报⽂向路由器申请加⼊和退出组播组，默认情况下路由器不会转发组播包到连接中的主机，除⾮主机通过 IGMP 加⼊到组播组，主机申请加⼊到组播组时，路由器就会记录 IGMP 路由器表，路由器后续就会转发组播包到对应的主机了。</li>
<li>IGMP 报⽂采⽤ IP 封装，IP 头部的协议号为 2，⽽且 TTL 字段值通常为 1，因为 IGMP 是⼯作在主机与连接的路由器之间。</li>
</ul>
<h3 id="IGMP工作机制"><a href="#IGMP工作机制" class="headerlink" title="IGMP工作机制"></a>IGMP工作机制</h3><p> <font color='orange'>IGMP 分为三个版本，分别是：IGMPv1、IGMPv2、IGMPv3。</font></p>
<p>以 IGMPv2 为例⼦，说说 常规查询与响应 和 离开组播组 这两个⼯作机制。</p>
<p><strong>常规查询与响应⼯作机制</strong></p>
<p><img src="https://raw.githubusercontent.com/lucky2shh/blog-haogeblogs-image/master/2023/08/05/image-20210415221848921.png?token=AIGEF3J4AISZEC7SBUT4H5LEZZRWY" alt="image-20210415221848921"></p>
<ol>
<li>路由器会周期性发送⽬的地址为 224.0.0.1 （表示同⼀⽹段内所有主机和路由器） IGMP 常规查询报⽂。 </li>
<li>主机1 和 主机 3 收到这个查询，随后会启动「报告延迟计时器」，计时器的时间是随机的，通常是 0~10 秒，计时器超时后主机就会发送 IGMP 成员关系报告报⽂（源 IP 地址为⾃⼰主机的 IP 地 址，⽬的 IP 地址为组播地址）。如果在定时器超时之前，收到同⼀个组内的其他主机发送的成员关系报告报⽂，则⾃⼰不再发送，这样可以减少⽹络中多余的 IGMP 报⽂数量。</li>
<li>路由器收到主机的成员关系报⽂后，就会在 IGMP 路由表中加⼊该组播组，后续⽹络中⼀旦该组播 地址的数据到达路由器，它会把数据包转发出去。</li>
</ol>
<p><strong>离开组播组⼯作机制</strong></p>
<p><font color='orange'>离开组播组的情况一，⽹段中仍有该组播组：</font></p>
<p><img src="https://raw.githubusercontent.com/lucky2shh/blog-haogeblogs-image/master/2023/08/05/image-20210415222033735.png?token=AIGEF3JE5ZCEGB2HNLAWDI3EZZRXY" alt="image-20210415222033735"></p>
<ol>
<li>主机 1 要离开组 224.1.1.1，发送 IGMPv2 离组报⽂，报⽂的⽬的地址是 224.0.0.2（表示发向⽹段 内的所有路由器）。</li>
<li>路由器 收到该报⽂后，以 1 秒为间隔连续发送 IGMP 特定组查询报⽂（共计发送 2 个），以便确 认该⽹络是否还有 224.1.1.1 组的其他成员。</li>
<li>主机 3 仍然是组 224.1.1.1 的成员，因此它⽴即响应这个特定组查询。路由器知道该⽹络中仍然存 在该组播组的成员，于是继续向该⽹络转发 224.1.1.1 的组播数据包。</li>
</ol>
<p><font color='orange'>离开组播组的情况⼆，⽹段中没有该组播组：</font></p>
<p><img src="https://raw.githubusercontent.com/lucky2shh/blog-haogeblogs-image/master/2023/08/05/image-20210415222133007.png?token=AIGEF3LA2MJ4DXOOQZ7TRL3EZZRYU" alt="image-20210415222133007"></p>
<ol>
<li>主机 1 要离开组播组 224.1.1.1，发送 IGMP 离组报⽂。</li>
<li>路由器收到该报⽂后，以 1 秒为间隔连续发送 IGMP 特定组查询报⽂（共计发送 2 个）。此时在该⽹段内，组 224.1.1.1 已经没有其他成员了，因此没有主机响应这个查询。</li>
<li>⼀定时间后，路由器认为该⽹段中已经没有 224.1.1.1 组播组成员了，将不会再向这个⽹段转发该组播地址的数据包。</li>
</ol>

                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">豪哥</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://hshz21.gitee.io/2023/08/07/ip-tu-biao-jie-xi/">https://hshz21.gitee.io/2023/08/07/ip-tu-biao-jie-xi/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="/about" target="_blank">豪哥</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/">
                                    <span class="chip bg-color">网络协议</span>
                                </a>
                            
                                <a href="/tags/IP/">
                                    <span class="chip bg-color">IP</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.4rem;
        line-height: 38px;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .close:hover {
        color: #ef5350;
        transform: scale(1.3);
        -moz-transform:scale(1.3);
        -webkit-transform:scale(1.3);
        -o-transform:scale(1.3);
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-content ul {
        padding-left: 0 !important;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        background-color: #ccc;
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff !important;
        background-color: #22AB38 !important;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff !important;
        background-color: #019FE8 !important;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/medias/reward/alipay.png" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/medias/reward/wxpay.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>

            
        </div>
    </div>

    

    

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/2023/08/07/tcp-ji-chu-zhi-shi/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/11.jpg" class="responsive-img" alt="计算机系列-TCP基础知识">
                        
                        <span class="card-title">计算机系列-TCP基础知识</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2023-08-07
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA/" class="post-category">
                                    计算机
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/">
                        <span class="chip bg-color">网络协议</span>
                    </a>
                    
                    <a href="/tags/TCP/">
                        <span class="chip bg-color">TCP</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2023/08/07/http-ji-chu-zhi-shi/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/4.jpg" class="responsive-img" alt="计算机系列-HTTP基础知识">
                        
                        <span class="card-title">计算机系列-HTTP基础知识</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2023-08-07
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA/" class="post-category">
                                    计算机
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/">
                        <span class="chip bg-color">网络协议</span>
                    </a>
                    
                    <a href="/tags/HTTP/">
                        <span class="chip bg-color">HTTP</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    
        <link rel="stylesheet" href="/libs/aplayer/APlayer.min.css">
<style>
    .aplayer .aplayer-lrc p {
        
        display: none;
        
        font-size: 12px;
        font-weight: 700;
        line-height: 16px !important;
    }

    .aplayer .aplayer-lrc p.aplayer-lrc-current {
        
        display: none;
        
        font-size: 15px;
        color: #42b983;
    }

    
    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body {
        left: -66px !important;
    }

    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover {
        left: 0px !important;
    }

    
</style>
<div class="">
    
    <div class="row">
        <meting-js class="col l8 offset-l2 m10 offset-m1 s12"
                   server="netease"
                   type="playlist"
                   id="503838841"
                   fixed='true'
                   autoplay='false'
                   theme='#42b983'
                   loop='all'
                   order='random'
                   preload='auto'
                   volume='0.7'
                   list-folded='true'
        >
        </meting-js>
    </div>
</div>

<script src="/libs/aplayer/APlayer.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script>

    
    <div class="container row center-align" style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2019-2023</span>
            
            <span id="year">2019</span>
            <a href="/about" target="_blank">豪哥</a>
            |&nbsp;Powered by&nbsp;<a href="https://github.com/lucky2shh" target="_blank">豪哥</a>
            <br>
            
            
            
            
            
            
            <span id="busuanzi_container_site_pv">
                |&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;<span id="busuanzi_value_site_pv"
                    class="white-color"></span>&nbsp;次
            </span>
            
            
            <span id="busuanzi_container_site_uv">
                |&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;<span id="busuanzi_value_site_uv"
                    class="white-color"></span>&nbsp;人
            </span>
            
            <br>
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">


    <a href="mailto:3577293158@qq.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>







    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=3577293158" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 3577293158" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>







</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

	
    

    

    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
